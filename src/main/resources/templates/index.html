<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <title>Campus Compass</title>

    <style>
        /* ê¸°ë³¸ ì„¤ì • */
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; font-family: sans-serif; }
        #map { width: 100%; height: 100%; position: relative; }
        .info-window { padding: 5px; font-size: 13px; font-weight: bold; color: #333; text-align: center; border-radius: 5px; white-space: nowrap; }

        /* 1. ìƒë‹¨ ê²€ìƒ‰ë°” ë° ë©”ë‰´ ë²„íŠ¼ */
        .top-ui-container {
            position: absolute;
            top: 15px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%; /* ëª¨ë°”ì¼ í™”ë©´ì— ë§ê²Œ ë„ˆë¹„ ì¡°ì • */
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 10;
        }

        #main-search-bar {
            flex-grow: 1;
            padding: 12px 15px;
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 25px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            font-size: 16px;
            outline: none;
            display: flex;
            align-items: center;
        }

        #main-search-bar input {
            border: none;
            flex-grow: 1;
            margin-left: 8px;
            font-size: 16px;
            outline: none;
        }

        #hamburger-menu-btn {
            background-color: #fff;
            border: none;
            padding: 10px 12px;
            border-radius: 50%;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            font-size: 20px;
            line-height: 1;
        }

        /* 2. ë‚´ ìœ„ì¹˜ ë²„íŠ¼ (FAB) */
        #my-location-fab {
            position: absolute;
            bottom: 250px; /* Bottom Sheetë¥¼ ìœ„í•´ ìœ„ì¹˜ ì¡°ì • */
            right: 15px;
            width: 50px;
            height: 50px;
            background-color: #fff;
            border: none;
            border-radius: 50%;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.15);
            font-size: 20px;
            color: #333;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10;
        }
        
        /* 3. ê±´ë¬¼ ìƒì„¸ ì •ë³´ì°½ (Bottom Sheet) */
        #building-bottom-sheet {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 40%; /* í™”ë©´ í•˜ë‹¨ 40% */
            background-color: #fff;
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
            box-shadow: 0 -4px 10px rgba(0, 0, 0, 0.2);
            z-index: 20;
            /* ê¸°ë³¸ ìˆ¨ê¹€ ìƒíƒœ (ì•„ë˜ë¡œ ì™„ì „íˆ ì´ë™) */
            transform: translateY(100%);
            transition: transform 0.3s ease-out;
            overflow: hidden;
            display: none; /* JS ì œì–´ ì „ê¹Œì§€ëŠ” display: none */
        }

        /* í™œì„±í™” ì‹œ ìŠ¤íƒ€ì¼ (JSë¡œ class ì¶”ê°€) */
        #building-bottom-sheet.active {
            transform: translateY(0);
            display: block;
        }

        .building-image-area {
            width: 100%;
            /* 16:9 ë¹„ìœ¨ì„ ìœ„í•œ Padding Hack */
            padding-top: 56.25%; /* 9/16 * 100% */
            position: relative;
            background-color: #f0f0f0;
            overflow: hidden;
        }

        .building-image-area img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .sheet-header {
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .building-info h1 {
            margin: 0 0 5px 0;
            font-size: 22px;
            color: #333;
        }

        .building-info p {
            margin: 0;
            font-size: 14px;
            color: #666;
        }

        #sheet-close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #888;
        }

        /* ì¸µ ì„ íƒ íƒ­ (ê°€ë¡œ ìŠ¤í¬ë¡¤) */
        .floor-tabs {
            display: flex;
            overflow-x: scroll;
            padding: 0 15px;
            gap: 8px;
            border-bottom: 1px solid #eee;
            -webkit-overflow-scrolling: touch; /* iOS ìŠ¤í¬ë¡¤ ë¶€ë“œëŸ½ê²Œ */
        }
        .floor-tabs::-webkit-scrollbar { display: none; } /* ìŠ¤í¬ë¡¤ë°” ìˆ¨ê¸°ê¸° */

        .floor-tab {
            white-space: nowrap;
            padding: 8px 15px;
            background-color: #f0f0f0;
            border-radius: 20px;
            cursor: pointer;
            font-size: 15px;
            color: #555;
            transition: background-color 0.2s;
            margin-bottom: 10px;
        }

        .floor-tab.active {
            background-color: #007bff; /* í™œì„±í™” ìƒ‰ìƒ */
            color: #fff;
            font-weight: bold;
        }

        /* ê°•ì˜ì‹¤ ë¦¬ìŠ¤íŠ¸ */
        .room-list-container {
            overflow-y: scroll;
            height: calc(100% - 150px); /* ì´ë¯¸ì§€+í—¤ë”+íƒ­ ë†’ì´ ì œì™¸ */
            padding: 0 15px;
            margin-top: 10px;
        }

        .room-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .room-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }

        .room-details {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .room-name {
            font-size: 16px;
            font-weight: bold;
            color: #333;
        }

        .status-badge {
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 12px;
            color: #fff;
        }

        .status-badge.available { background-color: #4CAF50; } /* ğŸ”µ ì‚¬ìš©ê°€ëŠ¥ */
        .status-badge.in-use { background-color: #F44336; } /* ğŸ”´ ìˆ˜ì—…ì¤‘ */

        .favorite-btn {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #ccc; /* ë¹„í™œì„±í™” ë³„ ìƒ‰ìƒ */
        }

        .favorite-btn.active {
            color: #FFC107; /* í™œì„±í™”(ì°œí•œ) ë³„ ìƒ‰ìƒ */
        }

        /* 4. ê²€ìƒ‰ ê²°ê³¼ ë¦¬ìŠ¤íŠ¸ (ê¸°ë³¸ ìˆ¨ê¹€) */
        #search-results-list {
            position: absolute;
            top: 65px; /* ê²€ìƒ‰ë°” ì•„ë˜ì— ìœ„ì¹˜ */
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-height: 50%;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
            z-index: 9;
            list-style: none;
            padding: 10px 0;
            margin: 0;
            display: none; /* ê²€ìƒ‰ì°½ í™œì„±í™” ì‹œ JSë¡œ ë³´ì´ê²Œ í•  ì˜ˆì • */
        }
        .search-result-item {
            padding: 10px 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            font-size: 16px;
            border-bottom: 1px solid #eee;
        }
        .search-result-item:last-child { border-bottom: none; }
        .search-result-icon { color: #888; }
        .no-results { text-align: center; padding: 20px; color: #888; }


        /* ì‚¬ì´ë“œ ë©”ë‰´ ì»¨í…Œì´ë„ˆ (ìŠ¬ë¼ì´ë“œ ìš©) */
        #side-menu-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 250px; /* ë©”ë‰´ ë„ˆë¹„ */
            height: 100%;
            background-color: #fff;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
            z-index: 30;
            transform: translateX(-100%); /* ê¸°ë³¸ ìˆ¨ê¹€ */
            transition: transform 0.3s ease-out;
        }
        /* ì‚¬ì´ë“œ ë©”ë‰´ ì˜¤ë²„ë ˆì´ (ë°°ê²½ ì–´ë‘¡ê²Œ) */
        #menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 29;
            display: none;
        }
    </style>
</head>
<body>

<div id="map"></div>

<div class="top-ui-container">
    <button id="hamburger-menu-btn" title="ë©”ë‰´">&#9776;</button>
    
    <div id="main-search-bar">
        <span class="search-icon">&#128269;</span>
        <input type="text" placeholder="ê±´ë¬¼, ê°•ì˜ì‹¤ ê²€ìƒ‰" onfocus="document.getElementById('search-results-list').style.display='block'" onblur="setTimeout(() => document.getElementById('search-results-list').style.display='none', 100)"/>
    </div>
</div>

<ul id="search-results-list">
    <li class="search-result-item">
        <span class="search-result-icon">&#127979;</span>
        <span>ì§„ë¦¬ê´€</span>
    </li>
    <li class="search-result-item">
        <span class="search-result-icon">&#128205;</span>
        <span>ë³¸ë¶€ë™ 201í˜¸</span>
    </li>
    <li class="search-result-item">
        <span class="search-result-icon">&#127979;</span>
        <span>í•™ìƒíšŒê´€</span>
    </li>
    </ul>

<button id="my-location-fab" title="ë‚´ ìœ„ì¹˜">&#9702;</button>


<div id="building-bottom-sheet">
    
    <div class="building-image-area">
        <img src="/images/default_building.png" alt="ê±´ë¬¼ ëŒ€í‘œ ì´ë¯¸ì§€" onerror="this.src='/images/default_building.png'"/>
    </div>
    
    <div class="sheet-header">
        <div class="building-info">
            <h1 class="building-name">ë³¸ë¶€ë™</h1>
            <p class="building-description">ëŒ€í•™ ë³¸ë¶€ ë° í–‰ì • ì‹œì„¤</p>
        </div>
        <button id="sheet-close-btn" title="ë‹«ê¸°">&times;</button>
    </div>

    <div class="floor-tabs">
        <div class="floor-tab active">ì „ì²´</div>
        <div class="floor-tab">1F</div>
        <div class="floor-tab">2F</div>
        <div class="floor-tab">3F</div>
        <div class="floor-tab">4F</div>
        <div class="floor-tab">B1</div>
        <div class="floor-tab">B2</div>
        <div class="floor-tab">Rooftop</div>
    </div>

    <div class="room-list-container">
        <ul id="room-list" class="room-list">
            <li class="room-item">
                <div class="room-details">
                    <span class="room-name">101í˜¸ ì „ê³µê°•ì˜ì‹¤</span>
                    <span class="status-badge available">ğŸ”µ ì‚¬ìš©ê°€ëŠ¥</span>
                </div>
                <button class="favorite-btn" title="ì¦ê²¨ì°¾ê¸°">&#9733;</button>
            </li>
            <li class="room-item">
                <div class="room-details">
                    <span class="room-name">203í˜¸ ì„¸ë¯¸ë‚˜ì‹¤</span>
                    <span class="status-badge in-use">ğŸ”´ ìˆ˜ì—…ì¤‘</span>
                </div>
                <button class="favorite-btn active" title="ì¦ê²¨ì°¾ê¸° í•´ì œ">&#9733;</button>
            </li>
            <li class="room-item">
                <div class="room-details">
                    <span class="room-name">305í˜¸ ì»´í“¨í„°ì‹¤</span>
                    <span class="status-badge available">ğŸ”µ ì‚¬ìš©ê°€ëŠ¥</span>
                </div>
                <button class="favorite-btn" title="ì¦ê²¨ì°¾ê¸°">&#9733;</button>
            </li>
            <li class="room-item">
                <div class="room-details">
                    <span class="room-name">306í˜¸ ë©ì‹¤</span>
                    <span class="status-badge in-use">ğŸ”´ ìˆ˜ì—…ì¤‘</span>
                </div>
                <button class="favorite-btn active" title="ì¦ê²¨ì°¾ê¸° í•´ì œ">&#9733;</button>
            </li>
            <li class="room-item">
                <div class="room-details">
                    <span class="room-name">401í˜¸ ëŒ€í˜• ê°•ì˜ì‹¤</span>
                    <span class="status-badge available">ğŸ”µ ì‚¬ìš©ê°€ëŠ¥</span>
                </div>
                <button class="favorite-btn" title="ì¦ê²¨ì°¾ê¸°">&#9733;</button>
            </li>
            </ul>
    </div>
</div>

<div id="menu-overlay"></div>

<div id="side-menu-container">
    <div style="padding: 20px;">
        <h2>Campus Compass</h2>
        <hr/>
        <div style="margin-bottom: 20px;">
            <p>ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤</p>
            <button>[ë¡œê·¸ì¸]</button>
        </div>
        
        <h3>ë‚´ê°€ ì°œí•œ ê°•ì˜ì‹¤</h3>
        <ul style="list-style: none; padding: 0;">
            <li style="padding: 5px 0; display: flex; justify-content: space-between; align-items: center;">
                <span>ì§„ë¦¬ê´€ 203í˜¸</span>
                <div>
                    <span style="margin-right: 5px;">&rarr;</span>
                    <span style="cursor: pointer;">&#128465;</span> </div>
            </li>
             <li style="padding: 5px 0; display: flex; justify-content: space-between; align-items: center;">
                <span>ë³¸ë¶€ë™ 203í˜¸</span>
                <div>
                    <span style="margin-right: 5px;">&rarr;</span>
                    <span style="cursor: pointer;">&#128465;</span> </div>
            </li>
            </ul>
    </div>
</div>


<script type="text/javascript" src="http://dapi.kakao.com/v2/maps/sdk.js?appkey=62ce24f8a9799f9545de678f7cd4fb4c"></script>

<script>
    // 1. ì§€ë„ ìƒì„±í•˜ê¸°
    var container = document.getElementById('map');
    var options = {
        center: new kakao.maps.LatLng(36.8392, 127.1835),
        level: 3
    };

    var map = new kakao.maps.Map(container, options);
    console.log("ì§€ë„ ë¡œë”© ì„±ê³µ! ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤...");

    kakao.maps.event.addListener(map, 'click', function(mouseEvent) {
        var latlng = mouseEvent.latLng;
        console.log('%c[ì¢Œí‘œ í™•ì¸]', 'color: blue; font-weight: bold;');
        console.log('ìœ„ë„(latitude): ' + latlng.getLat());
        console.log('ê²½ë„(longitude): ' + latlng.getLng());
        console.log('ë³µì‚¬ìš© SQL: ' + latlng.getLat() + ', ' + latlng.getLng());
    });
    // =========================================================

    // ğŸ’¡ JS ì„ì‹œ ë™ì‘ ì¶”ê°€: Bottom Sheet ì—´ê¸°/ë‹«ê¸° (í¼ë¸”ë¦¬ì‹± í™•ì¸ìš©)
    const sheet = document.getElementById('building-bottom-sheet');
    const closeBtn = document.getElementById('sheet-close-btn');

    closeBtn.addEventListener('click', () => {
        sheet.classList.remove('active');
    });

    // ë§ˆì»¤ í´ë¦­ ì‹œ Bottom Sheetê°€ ì—´ë¦¬ë„ë¡ ê¸°ì¡´ ë¡œì§ ìˆ˜ì •
    function openBottomSheet() {
        sheet.classList.add('active');
    }
    
    // 2. ë°±ì—”ë“œ API í˜¸ì¶œí•˜ì—¬ ê±´ë¬¼ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
    fetch('/api/buildings')
        .then(response => {
            if (!response.ok) {
                throw new Error('ë„¤íŠ¸ì›Œí¬ ì‘ë‹µì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
            }
            return response.json();
        })
        .then(buildings => {
            console.log('ê°€ì ¸ì˜¨ ê±´ë¬¼ ë°ì´í„°:', buildings);

            // 3. ê°€ì ¸ì˜¨ ë°ì´í„°ë§Œí¼ ë°˜ë³µí•˜ë©° ë§ˆì»¤ ìƒì„±
            buildings.forEach(function(building) {

                // ë§ˆì»¤ê°€ í‘œì‹œë  ìœ„ì¹˜
                var markerPosition  = new kakao.maps.LatLng(building.latitude, building.longitude);

                // ë§ˆì»¤ ìƒì„±
                var marker = new kakao.maps.Marker({
                    position: markerPosition,
                    map: map // ì§€ë„ì— ì˜¬ë¦¬ê¸°
                });

                // 4. ë§ˆì»¤ì— ì´ë¦„í‘œ(ì¸í¬ìœˆë„ìš°) ë‹¬ê¸° ë° í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
                var content = '<div class="info-window">' + building.name + '</div>';

                var infowindow = new kakao.maps.InfoWindow({
                    content : content
                });

                // ë§ˆìš°ìŠ¤ ì˜¬ë ¸ì„ ë•Œ ì´ë¦„í‘œ ì—´ê¸°
                kakao.maps.event.addListener(marker, 'mouseover', function() {
                    infowindow.open(map, marker);
                });

                // ë§ˆìš°ìŠ¤ ì¹˜ì› ì„ ë•Œ ì´ë¦„í‘œ ë‹«ê¸°
                kakao.maps.event.addListener(marker, 'mouseout', function() {
                    infowindow.close();
                });
                
                // â­ ë§ˆì»¤ í´ë¦­ ì‹œ Bottom Sheet ì—´ê¸° (ì¶”ê°€ëœ ë¶€ë¶„)
                kakao.maps.event.addListener(marker, 'click', function() {
                    openBottomSheet();
                    // ì—¬ê¸°ì— building.id ë“±ì„ ì‚¬ìš©í•˜ì—¬ Bottom Sheetì— ê±´ë¬¼ ìƒì„¸ ì •ë³´ë¥¼ ì±„ìš°ëŠ” ë¡œì§ì´ ì¶”ê°€ë  ì˜ˆì •ì…ë‹ˆë‹¤.
                });

            });
        })
        .catch(error => {
            console.error('ê±´ë¬¼ ë°ì´í„° ë¡œë”© ì‹¤íŒ¨:', error);
        });
</script>
</body>
</html>
